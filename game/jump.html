<html>
    <script src="phaser.js"></script>
    <script type="text/javascript">

        var game = new Phaser.Game(1024, 512, Phaser.AUTO, '', { preload: preload, create: create, update: update});
        var gato;
        var bg_n;
        var bg_c;
        var grupo;
        var contador;
        var texto;
        var moedas = new Array();
        
        function preload() {
            game.load.spritesheet('gato', 'assets/imagens/gato.png', 397, 200, 13);
            game.load.spritesheet('moeda', 'assets/imagens/moedas.png', 44, 40, 10);
            game.load.image('background', 'assets/imagens/background_nuvem.png');
            game.load.image('caminho', 'assets/imagens/caminho.png');
        }
        
        function create() {
            bg_n = game.add.tileSprite(0, 0, 1024, 512, 'background');
            bg_c = game.add.tileSprite(0, 450, 1024, 200, 'caminho');

            grupo = game.add.group();

            for (var i = 0; i < 50; i++)
            {
                moeda = grupo.create(500+i*300, 200, 'moeda');
                moeda.animations.add('transicao');
                moeda.animations.play('transicao', 10, true);
                moeda.pixelPerfect = true;
                moedas[moedas.length] = moeda;
            }

            gato = game.add.sprite(10, 300, 'gato');
            gato.animations.add('correr');
            gato.animations.play('correr', 15, true);
            game.stage.scale.startFullScreen();
            gato.input.pixelPerfect = true;

            contador = 0;

            texto = game.add.text(10, 10, "Moedas: " + contador, {
                font: "20px Arial",
                fill: "#ff0044",
                align: "center"
            });
        }
        
        function update() {

            gato.body.velocity.x = 0;
            gato.body.velocity.y = 0;
            bg_n.tilePosition.x -= 1;
            bg_c.tilePosition.x -= 4;

            console.log(moedas[0].body.velocity);
            for (i=0; i < moedas.length; i++)
                moedas[i].body.velocity.x = -200;

            if (game.input.keyboard.isDown(Phaser.Keyboard.SPACEBAR))
            {
                gato.body.velocity.y = -300;
            }
            else if (gato.body.y < 300) {
                gato.body.velocity.y = 250;
            }
            game.physics.collide(gato, grupo, tratador_colisao, null, this);
        }

        function tratador_colisao(obj1, obj2) {
            obj2.kill();
            contador++;
            texto.setText("Moedas: " + contador);
        }

    </script>
</html>
