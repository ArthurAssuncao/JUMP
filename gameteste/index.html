<html>
    <script src="phaser.min.js"></script>
    <script type="text/javascript">

    var game = new Phaser.Game(1024, 800, Phaser.CANVAS, 'Agachar e Pular', { preload: preload, create: create, update: update });

    function preload() {
        game.load.tilemap('mapa', 'mapa.json', null, Phaser.Tilemap.TILED_JSON);
        game.load.tileset('deserto', 'deserto.png', 32, 32, -1, 1, 1);
        game.load.image('mato', 'mato.png');
    }

    var mapa;
    var tileset;
    var camada;
    var cursores;
    var jogador;

    function create() {

        mapa = game.add.tilemap('mapa');
        tileset = game.add.tileset('deserto');
        
        tileset.setCollisionRange(0, tileset.total - 1, true, true, true, true);
        
        tileset.setCollision(29, false, false, false, false);
        camada = game.add.tilemapLayer(0, 0, 1024, 800, tileset, mapa, 0);

        camada.resizeWorld();

        jogador = game.add.sprite(150, 550, 'mato');
        jogador.anchor.setTo(0.5, 0.5);

        game.camera.follow(jogador);

        cursores = game.input.keyboard.createCursorKeys();
    }

    function update() {

        game.physics.collide(jogador, camada);
        jogador.body.velocity.y = 0;
        jogador.body.velocity.x = 100;

        if (cursores.up.isDown)
        {
            jogador.body.velocity.y = -100;
        }
        else if (cursores.down.isDown)
        {
            jogador.body.velocity.y = 100;
        }

        if (cursores.left.isDown)
        {
            jogador.body.velocity.x = -100;
            jogador.scale.x = -1;
        }
        else if (cursores.right.isDown)
        {
            jogador.body.velocity.x = 100;
            jogador.scale.x = 1;
        }
    }

    </script>
</html>
